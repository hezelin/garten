<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>农耕知识列表</title>
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta content="telephone=no,email=no" name="format-detection">
		<script src="../js/flexible_css.debug.js"></script>
		<script src="../js/flexible.debug.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/style.css" rel="stylesheet" />
		<style>
			html,
			body {
				font-size: 0;
			}
			
			[v-cloak] {
				display: none;
			}
			
			#message {
				font-size: 16px;
				text-align: center;
				margin-top: 10px;
			}
		</style>
	</head>

	<body>
		<div class="header-control header-control-fixed">
			<div class="header-control-left-btn  mui-action-back">
				<span class="white-arrow-big-span header-control-left-btn-span"></span>
			</div>
			<div>
				<span id="webview-head-title"></span>
			</div>
			<div class="header-control-right-btn">
				<span class="header-control-right-btn-span"></span>
			</div>
		</div>
		<div id="head-holder"></div>
		<div class="comu-knowledge-list-container">
			<div class="spinner" style="display: block;">
				<div class="bounce1"></div>
				<div class="bounce2"></div>
				<div class="bounce3"></div>
			</div>
			<div id="message" style="display: none;">
				该分类下没有相关文章!
			</div>
			<div class="comu-knowledge-list-item" v-cloak v-for="item in data" v-on:tap="openDetail" data-id="{{item.id}}" style="background: url({{item.cover}}); background-size: cover;background-position: center;">
				<div class="comu-knowledge-list-item-title">{{item.name}}</div>
			</div>
		</div>

		<div class="my-toast" id="myToast">
			<span class="my-toast-content"></span>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/md5.min.js"></script>
		<script src="../js/public.js"></script>
		<script src="../js/vue.min.js"></script>
		<script>
			mui.init();

			function dataOnload(dataLength) {
				document.querySelector(".spinner").style.display = "none";
				if (dataLength == 0) {
					document.getElementById("message").style.display = "block";
				}
			}

			function initVue(res) {
				var vueObj = new Vue({
					el: ".comu-knowledge-list-container",
					data: res,
					methods: {
						openDetail: function(event) {
							var thisBtn = event.currentTarget;
							var _id = thisBtn.getAttribute("data-id");
							mui.openWindow({
								url: "webview-comu-knowledge-detail.html",
								styles: fnSetSubpageStyle(0, 0),
								createNew: false,
								extras: {
									itemID: _id
								},
								show: {
									autoShow: true,
									aniShow: "pop-in",
									duration: 300
								},
								waiting: {
									autoShow: true
								}
							});
						}
					}
				});
				Vue.nextTick(function() {
					dataOnload(res.data.length);
				});
			}

			function getData(id) {
				var URL = "http://farm.rrzuji.com/v1/wiki/index?fields=id,name,category,cover&category_id=" + id + "&" + fnCreateSign();
				mui.ajax(URL, {
					type: "GET",
					dataType: "JSON",
					timeout: 15000,
					success: function(res) {
						res = JSON.parse(res);
						if (res.success) {
							initVue(res);
						}
					},
					error: function(xhr) {
						ajaxError(xhr);
					}
				});
			};
			mui.plusReady(function() {
				var cw = plus.webview.currentWebview();
				document.getElementById("webview-head-title").innerText = cw.categoryTitle;
				getData(cw.categoryID);
			});
		</script>
	</body>

</html>