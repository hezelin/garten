<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>详情</title>
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta content="telephone=no,email=no" name="format-detection">
		<script src="../js/flexible_css.debug.js"></script>
		<script src="../js/flexible.debug.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/style.css" rel="stylesheet" />
		<style>			
			[v-cloak] {
				display: none;
			}
		</style>
	</head>

	<body>
		<div class="header-control header-control-fixed">
			<div class="header-control-left-btn  mui-action-back">
				<span class="white-arrow-big-span header-control-left-btn-span"></span>
			</div>
			<div>
				<span id="webview-head-title"></span>
			</div>
			<div class="header-control-right-btn">
				<span class="header-control-right-btn-span"></span>
			</div>
		</div>
		<div id="head-holder"></div>
		<!--轮播图尺寸规定为750*350-->
		<div id="vueContainer">
			<div id="slider" class="mui-slider" v-cloak>
				<div class="mui-slider-group mui-slider-loop">
					<!--这里有个bug，页面打开时会显示第一张轮播图-->
					<!-- (循环轮播：第一个节点是最后一张图片) 节点数量等于轮播图片+1-->
					<!--轮播图尺寸规定为750*350-->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<span class="span-cover-slider" style="background: url({{data.images[data.images.length - 1]}}); background-size: cover; background-position: center;"></span>
						</a>
					</div>
					<div class="mui-slider-item" v-for="img in data.images">
						<a href="#">
							<span class="span-cover-slider" style="background: url({{img}}); background-size: cover; background-position: center;"></span>
						</a>
					</div>
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<span class="span-cover-slider" style="background: url({{data.images[0]}}); background-size: cover; background-position: center;"></span>
						</a>
					</div>
					<!--额外增加的一个节点(最后一个节点与“原”第一张图片相同)-->
				</div>
				<div class="mui-slider-indicator mui-text-center">
					<div class="mui-indicator mui-active home-slider-text-size"></div>
					<div class="mui-indicator home-slider-text-size" v-for="n in data.images.length" v-if="n > 0"></div>
				</div>
			</div>
			<div class="comu-knowledge-item" v-if="data.wiki.length > 0" v-cloak>
				<label class="comu-knowledge-title"> 知识百科</label>
				<hr class="comu-knowledge-hr">
				<p class="comu-knowledge-article">
					{{data.wiki}}
				</p>
			</div>

			<div class="comu-knowledge-item" v-if="data.grow.length > 0" v-cloak>
				<label class="comu-knowledge-title">生长环境</label>
				<hr class="comu-knowledge-hr">
				<p class="comu-knowledge-article">
					{{data.grow}}
				</p>
			</div>

			<div class="comu-knowledge-item" v-if="data.pabulum.length > 0" v-cloak>
				<label class="comu-knowledge-title">营养价值</label>
				<hr class="comu-knowledge-hr">
				<p class="comu-knowledge-article">
					{{data.pabulum}}
				</p>
			</div>

			<div class="comu-knowledge-item" v-if="data.plant.length > 0" v-cloak>
				<label class="comu-knowledge-title">栽培</label>
				<hr class="comu-knowledge-hr">
				<p class="comu-knowledge-article">
					{{data.plant}}
				</p>
			</div>

			<div class="comu-knowledge-item" v-if="data.disease.length > 0" v-cloak>
				<label class="comu-knowledge-title">防治虫害疫病</label>
				<hr class="comu-knowledge-hr">
				<p class="comu-knowledge-article">
					{{data.disease}}
				</p>
			</div>
		</div>
		<div class="my-toast" id="myToast">
			<span class="my-toast-content"></span>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/md5.min.js"></script>
		<script src="../js/public.js"></script>
		<script src="../js/vue.min.js"></script>
		<script>
			mui.init();

			function initVue(res) {
				var vueObj = new Vue({
					el: "#vueContainer",
					data: res,
					methods: {
						openDetail: function(event) {
							var thisBtn = event.currentTarget;
							var _id = thisBtn.getAttribute("data-id");
							mui.openWindow({
								url: "webview-comu-knowledge-detail.html",
								styles: fnSetSubpageStyle(0, 0),
								createNew: false,
								extras: {
									itemID: _id
								},
								show: {
									autoShow: true,
									aniShow: "pop-in",
									duration: 300
								},
								waiting: {
									autoShow: true
								}
							});
						}
					}
				});
				vueObj.$nextTick(function() {
					mui(".mui-slider").slider({
						interval: 5000
					});
				});
			}

			function getData(id) {
				var URL = "http://farm.rrzuji.com/v1/wiki/view?id=" + id + "&" + fnCreateSign();
				mui.ajax(URL, {
					type: "GET",
					dataType: "JSON",
					timeout: 15000,
					success: function(res) {
						console.log(res);
						res = JSON.parse(res);
						if (res.success) {
							initVue(res);
							document.getElementById("webview-head-title").innerText = res.data.name;
						}
					},
					error: function(xhr) {
						ajaxError(xhr);
					}
				});
			};
			mui.plusReady(function() {
				var cw = plus.webview.currentWebview();
				getData(cw.itemID);
			});
		</script>
	</body>

</html>