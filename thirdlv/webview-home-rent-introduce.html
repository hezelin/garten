<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>详情</title>
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta content="telephone=no,email=no" name="format-detection">
		<script src="../js/flexible_css.debug.js"></script>
		<script src="../js/flexible.debug.js"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/style.css" rel="stylesheet" />
		<style>
			html,
			body {
				background-color: rgb(255, 255, 255);
				/*background-color: #efeff4;*/
			}
		</style>
	</head>

	<body>
		<div class="home-rent-introduce-container">
			<div id="showBarContainer">
				<div id="showBar" data-left="0" style="transform: translate3d(0px, 0px, 0px) translateZ(0px); transition-duration: 0ms; transition-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1);">
					<div class="showBar-item">
						<a class="showBar-a">
							<img class="showBar-img" src="../img/tradeListbg1.png">
						</a>
					</div>
					<div class="showBar-item">
						<a class="showBar-a">
							<img class="showBar-img" src="../img/tradeListbg1.png">
						</a>
					</div>
					<div class="showBar-item">
						<a class="showBar-a">
							<img class="showBar-img" src="../img/tradeListbg1.png">
						</a>
					</div>
					<div class="showBar-item">
						<a class="showBar-a">
							<img class="showBar-img" src="../img/tradeListbg1.png">
						</a>
					</div>
					<div class="showBar-item">
						<a class="showBar-a">
							<img class="showBar-img" src="../img/tradeListbg1.png">
						</a>
					</div>
				</div>
				<div class="pageIndex">

				</div>
			</div>
			<div id="testData1"></div>
			<div id="testData2"></div>
			<!--详细介绍-->
			<span class="home-rent-detail-name">
				认租玉米地 (xxxxxxx) xxxxx
			</span>
		</div>

		<div class="trade-foot-control">
			<div class="trade-foot-control-btn">
				<span class="shop-car-span"></span>
				<span class="trade-foot-control-name">购物车</span>
			</div>
			<div class="trade-foot-control-btn bg-color-green" id="buyNow">
				<span class="shop-buy-span"></span>
				<span class="trade-foot-control-name">立即购买</span>
			</div>
		</div>

		<!--购买div，动画形式弹出-->
		<div id="buyDiv" class="mutual-div">
			<div class="buyDiv-title">
				<span class="buyDiv-title-img" style="background: url(../img/shop-detail.png); background-size: cover;"></span>
				<span class="buyDiv-title-context">某某农家乐 xxxxxx</span>
				<span id="buyDivClose"></span>
			</div>
			<div class="buyDiv-count">
				<div class="buyDiv-count-left">
					<label class="buyDiv-count-title">
						购买数量
					</label>
				</div>
				<div class="buyDiv-count-right">
					<div class="num-choice">
						<span class="num-choice-left num-choice-item">-</span>
						<span class="num-choice-mid num-choice-item">1</span>
						<span class="num-choice-right num-choice-item">+</span>
					</div>
					<span class="buyDiv-money">总价：&yen;&nbsp;<em class="buyDiv-money-count" data-normal="250">250</em></span>
				</div>
			</div>
			<div class="buyDiv-btn">
				<button id="btnPostBuy">完成</button>
			</div>
		</div>
		<!--end-->
		<div class="my-toast" id="myToast">
			<span class="my-toast-content"></span>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/md5.min.js"></script>
		<script src="../js/public.js"></script>
		<script>
			mui.init();
			// 购买-动画
			document.querySelector("#buyNow").addEventListener("tap", function() {
				var id = "#buyDiv";
				fnOpenTargetDiv(id);
			});
			document.querySelector("#buyDivClose").addEventListener("tap", function() {
				var id = "#buyDiv";
				fnCloseShade(id);
			});
			// 购买-动画end
			//数字选择器
			var chocieMID = document.querySelector(".num-choice-mid");
			var choicePrice = document.querySelector(".buyDiv-money-count");
			var basePrice = parseFloat(choicePrice.getAttribute("data-normal"));
			document.querySelector(".num-choice-left").addEventListener("tap", function() {
				var val = chocieMID.innerText;
				if (val == "1") {
					return;
				}				
				chocieMID.innerText = parseInt(val) - 1;
				choicePrice.innerText = parseFloat(choicePrice.innerText) - basePrice;
			});
			document.querySelector(".num-choice-right").addEventListener("tap", function() {
				chocieMID.innerText = parseInt(chocieMID.innerText) + 1;
				choicePrice.innerText = parseFloat(choicePrice.innerText) + basePrice;
			});
			//数字选择器end
			
			var alam = {
				remind: function(func) {
					func();
					this.timeoutID = undefined;
				},
				setup: function(myFunc) {
					//清除上一个timeout
					if (typeof this.timeoutID === "number") {
						this.cancel();
						this.timeoutID = window.setTimeout(function(Func) {
							this.remind(Func);
						}.bind(this), 300, myFunc);
					} else {
						this.timeoutID = window.setTimeout(function(Func) {
							this.remind(Func);
						}.bind(this), 300, myFunc);
					}
				},
				cancel: function() {
					window.clearTimeout(this.timeoutID);
					this.timeoutID = undefined;
				}
			}
			mui.plusReady(function() {
				setTimeout(function() {
					fnShowBarOperate();
				}, 400);
			});

			function fnShowBarOperate() {
				//获取屏幕视口宽度				
				var screenScale = plus.screen.scale;
				var screenWidth = plus.screen.resolutionWidth;
				screenWidth = mui.os.ios ? screenWidth * screenScale : screenWidth;  
				//初始化页标
				document.querySelector(".pageIndex").innerText = 1 + "/" + document.querySelectorAll(".showBar-img").length;
				var nStartX = 0;
				var container = document.querySelector("#showBarContainer");
				var oBar = document.querySelector("#showBar");
				container.addEventListener("swipeleft", function(e) {
					console.log("向左滑");
					console.log(Range);
				});
				container.addEventListener("swiperight", function(e) {
					console.log("向右滑");
					console.log(Range);
				});
				container.addEventListener("touchstart", function(e) {
					e.preventDefault();
					nStartX = e.targetTouches[0].pageX;
				});
				container.addEventListener("touchmove", function(e) {
					e.preventDefault();
					var touch = e.targetTouches[0];
					var _left = parseFloat(oBar.getAttribute("data-left"));
					var _L = _left + touch.pageX - nStartX;
					oBar.setAttribute("data-left", _L);
					oBar.style.transform = "translate3d(" + _L + "px, 0px, 0px)";
					oBar.style.WebkitTransform = "translate3d(" + _L + "px, 0px, 0px)";
					nStartX = touch.pageX;
				});
				container.addEventListener("touchend", function(e) {
					e.preventDefault();
					//已移动距离
					var Range = parseFloat(oBar.getAttribute("data-left")) % screenWidth;
					var Middle = screenWidth / 2;
					console.log(Range);
					console.log(screenWidth);
					var Count = document.querySelectorAll(".showBar-img").length - 1;
					var _left = parseFloat(oBar.getAttribute("data-left"));
					Range = Math.abs(Range);
					if (Range <= Middle) {
						// 左移						
						_left = _left + Range;		
					} else {
						// 右移
						_left = _left - (screenWidth - Range);
					}
					if (_left >= 0) {
						//不能继续右移
						_left = 0;
					} else if (_left <= -screenWidth * Count) {
						//不能继续左移
						_left = -screenWidth * Count;
					}
					oBar.style.transform = "translate3d(" + _left + "px, 0px, 0px)";
					oBar.style.WebkitTransform = "translate3d(" + _left + "px, 0px, 0px)";
					oBar.style.transitionDuration = "1000ms";
					oBar.style.webkitTransitionDuration = "1000ms";
					//使用timeout队列解决滑动冲突的问题
					alam.setup(function() {
						oBar.style.transitionDuration = "0ms";
						oBar.style.webkitTransitionDuration = "0ms";
					});
					oBar.setAttribute("data-left", _left);
					//更改图片索引
					var currentIMG = parseInt(-_left / screenWidth) + 1;
					document.querySelector(".pageIndex").innerText = currentIMG + "/" + (Count + 1);
				});
			}
		</script>
	</body>

</html>