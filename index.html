<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta content="telephone=no,email=no" name="format-detection">
		<script src="js/flexible_css.debug.js"></script>
		<script src="js/flexible.debug.js"></script>
		<!--<link href="css/mui.min.css" rel="stylesheet" />-->
		<link href="css/style.css" rel="stylesheet" />
		<title></title>
	</head>

	<body>
		<div id="index-bar-tab">
			<div class="index-tab-item index-tab-active" data-href="webview-home.html">
				<span class="icon-index icon-index-home"></span>
				<span class="icon-label">首页</span>
			</div>
			<div class="index-tab-item" data-href="webview-comu.html">
				<span class="icon-index icon-index-comu"></span>
				<span class="icon-label">社区</span>
			</div>
			<div class="index-tab-item" data-href="webview-nav.html">
				<span class="icon-index icon-index-nav"></span>
				<span class="icon-label">地图</span>
			</div>
			<div class="index-tab-item" data-href="webview-my.html">
				<span class="icon-index icon-index-info"></span>
				<span class="icon-label">我的</span>
			</div>
		</div>

		<script src="js/mui.min.js"></script>
		<script src="js/md5.min.js"></script>
		<script src="js/public.js"></script>
		<script>
			mui.init();
			mui.plusReady(function() {
				mui.init();
				//仅支持竖屏显示
				plus.screen.lockOrientation("portrait-primary");
				//首页返回键处理
				//处理逻辑：1秒内，连续两次按返回键，则退出应用；
				var first = null;
				mui.back = function() {
					if (!first) {
						first = new Date().getTime();
						mui.toast('再按一次退出应用');
						setTimeout(function() {
							first = null;
						}, 2000);
					} else {
						if (new Date().getTime() - first < 2000) {
							plus.runtime.quit();
						}
					}
				};
				//
				//初始化
				var subpages = ['webview-home.html', 'webview-comu.html', 'webview-nav.html', 'webview-my.html'];
				var aniShow = {};
				var self = plus.webview.currentWebview();
				for (var i = 0; i < 4; i++) {
					var temp = {};
					var sub;
					if (i == 3) {
						sub = mui.preload({
							url: subpages[i],
							id: subpages[i],
							styles: fnSetSubpageStyle(0, 112)
						});
						sub.onloaded = function() {
							var delayTime = mui.os.ios ? 100 : 1000;
							setTimeout(function() {
								//四个基本标签和父模板加载完后，延时关闭app启动页
								//接下来预加载头部webviewhead与webviewbody
								plus.navigator.closeSplashscreen();
								//预载公用父模板
								var webHead = mui.preload({
									url: "webview-header.html",
									id: "webview-header",
									styles: fnSetSubpageStyle(0, 0)
								});
								//预载商品父模板
								var trade = mui.preload({
									url: "webview-trade-header.html",
									id: "webview-trade-header",
									styles: fnSetSubpageStyle(0, 0)
								});
							}, delayTime);
						}
					} else {
						sub = mui.preload({
							url: subpages[i],
							id: subpages[i],
							styles: fnSetSubpageStyle(0, 112)
						});
					}
					if (i > 0) {
						sub.hide();
					} else {
						temp[subpages[i]] = "true";
						mui.extend(aniShow, temp);
					}
					self.append(sub);
				}
				//当前激活选项
				var activeTab = "webview-home.html";
				//选项卡点击事件
				mui("#index-bar-tab").on("tap", ".index-tab-item", function(e) {
					var targetTab = this.getAttribute("data-href");
					if (targetTab == activeTab) {
						return;
					}
					if (targetTab == "webview-my.html") {
						//检查是否登录
						if (userLoginStatus()) {
							
						} else {
							plus.webview.open("login/login.html", "login.html", {}, "slide-in-right");
						}
					} else {
						//显示目标选项卡
						document.querySelector(".index-tab-active").classList.remove("index-tab-active");
						this.classList.add("index-tab-active");
						if (mui.os.ios || aniShow[targetTab]) {
							plus.webview.show(targetTab, "none", 300);
						} else {
							var temp = {};
							temp[targetTab] = "true";
							mui.extend(aniShow, temp);
							plus.webview.show(targetTab, "none", 300);
						}
						//隐藏当前;
						plus.webview.hide(activeTab, "none");
						//更改当前活跃的选项卡
						activeTab = targetTab;
					}
				});
			});
		</script>
	</body>

</html>