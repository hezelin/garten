<html>

	<head>
		<meta charset="utf-8">
		<title>设置</title>
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta content="telephone=no,email=no" name="format-detection">
		<script src="../js/flexible_css.debug.js"></script>
		<script src="../js/flexible.debug.js"></script>
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/feedback-page.css">
		<link rel="stylesheet" href="../css/style.css">
		<style>
		</style>
	</head>

	<body class="mui-fullscreen">
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="setting" class="mui-page">
			<!--mui-navbar-inner mui-bar mui-bar-nav-->
			<div class="header-control-color header-control header-control-fixed mui-navbar-inner">
				<div class="header-control-left-btn mui-action-back">
					<span class="white-arrow-big-span header-control-left-btn-span"></span>
				</div>
				<div>
					<span id="webview-head-title">设置</span>
				</div>
				<div class="header-control-right-btn">
					<span class="header-control-right-btn-span"></span>
				</div>
			</div>
			<!--新标题结束-->
			<!--页面标题栏结束-->

			<!--页面主内容区开始-->
			<div class="mui-page-content">
				<!--区域滚动容器 mui-scroll-wrapper mui-scroll-->
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<!--账号-->
						<a class="my-setting-item my-setting-item-margin-top my-setting-item-margin-bottom" href="#account">
							<!--左边内容区域-->
							<div class="my-setting-left">
								<label class="my-setting-left-text">账户</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle">
								<label class="my-setting-middle-text"></label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<!--提示声音-->
						<a class="my-setting-item">
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">提示声音</label>
							</div>
							<div class="my-setting-middle my-setting-middle-right my-setting-border">
								<div class="mui-switch mui-active">
									<div class="mui-switch-handle"></div>
								</div>
							</div>
						</a>
						<!--意见反馈-->
						<a class="my-setting-item" id="feedback-btn" href="#feedback">
							<!--左边内容区域-->
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">意见反馈</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-border">
								<label class="my-setting-middle-text"></label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right my-setting-border">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<!--关于我们-->
						<a class="my-setting-item" href="#about">
							<!--左边内容区域-->
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">关于我们</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-border">
								<label class="my-setting-middle-text"></label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right my-setting-border">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<!--检查更新-->
						<a class="my-setting-item" id="update">
							<!--左边内容区域-->
							<div class="my-setting-left">
								<label class="my-setting-left-text">检查更新</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-middle-right">
								<label class="my-setting-middle-text">当前版本1.0</label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<!--客服热线-->
						<a class="my-setting-item my-setting-item-margin-top">
							<!--左边内容区域-->
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">客服热线</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-middle-right my-setting-border">
								<label class="my-setting-middle-text">020-86481132</label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right my-setting-border">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<a id="my-setting-loginout">
							<label>退出登录</label>
						</a>
					</div>
				</div>
			</div>
			<!--页面主内容区结束-->
		</div>
		<!--单页面结束-->

		<!--子页面模板start-->
		<div id="notifications" class="mui-page">
			<div class="header-control-color header-control header-control-fixed mui-navbar-inner">
				<div class="header-control-left-btn  mui-action-back">
					<span class="white-arrow-big-span header-control-left-btn-span"></span>
				</div>
				<div>
					<span id="webview-head-title">窗口标题</span>
				</div>
				<div class="header-control-right-btn">
					<span class="help-about-span header-control-right-btn-span"></span>
				</div>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<a class="my-setting-item my-setting-item-margin-top my-setting-item-margin-bottom">
							<!--左边内容区域-->
							<div class="my-setting-left">
								<label class="my-setting-left-text" </label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-middle-right">
								<label class="my-setting-middle-text"></label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right">
								<span class="black-arrow-span"></span>
							</div>
						</a>
					</div>
				</div>
			</div>
		</div>
		<!--子页面模板end-->

		<!--资料-->
		<div id="account" class="mui-page">
			<div class="header-control-color header-control header-control-fixed mui-navbar-inner">
				<div class="header-control-left-btn mui-action-back">
					<span class="white-arrow-big-span header-control-left-btn-span"></span>
				</div>
				<div>
					<span id="webview-head-title">资料</span>
				</div>
				<div class="header-control-right-btn">
					<span class="header-control-right-btn-span"></span>
				</div>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<!--修改头像-->
						<a class="my-setting-item my-setting-item-margin-top" id="head">
							<!--左边内容区域-->
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">修改头像</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-border my-setting-middle-right">
								<img class="my-setting-user-img" id="settingUserIMG" src="" />
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right my-setting-border">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<!--昵称-->
						<a class="my-setting-item" href="#nickname">
							<!--左边内容区域-->
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">昵称</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-border my-setting-middle-right">
								<label class="my-setting-middle-text" id="nickNameText">格子</label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right my-setting-border">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<!--手机号-->
						<a class="my-setting-item" href="#editPhone">
							<!--左边内容区域-->
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">手机号</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-border my-setting-middle-right">
								<label class="my-setting-middle-text" id="phoneText"></label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right my-setting-border">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<!--性别-->
						<a class="my-setting-item" id="setSex">
							<!--左边内容区域-->
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">性别</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-middle-right my-setting-border">
								<label class="my-setting-middle-text" id="genderText">保密</label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right my-setting-border">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<!--收件地址-->
						<a class="my-setting-item my-setting-item-margin-top my-setting-item-margin-bottom" href="#editAddress">
							<!--左边内容区域-->
							<div class="my-setting-left">
								<label class="my-setting-left-text">收件地址</label>
							</div>
							<!--中间内容区域-->
							<div class="my-setting-middle my-setting-middle-right">
								<label class="my-setting-middle-text">设置</label>
							</div>
							<!--右边内容区域-->
							<div class="my-setting-right">
								<span class="black-arrow-span"></span>
							</div>
						</a>
					</div>
				</div>
			</div>
		</div>
		<!--修改昵称-->
		<div id="nickname" class="mui-page">
			<div class="header-control-color header-control header-control-fixed mui-navbar-inner">
				<div class="header-control-left-btn  mui-action-back">
					<span class="white-arrow-big-span header-control-left-btn-span"></span>
				</div>
				<div>
					<span id="webview-head-title">修改昵称</span>
				</div>
				<div class="header-control-right-btn">
					<span class="header-control-right-btn-span">
						<button id="saveNickName" class="my-setting-save">保存</button>
					</span>
				</div>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="input-name-container">
							<input id="inputNickName" class="mui-input-clear" placeholder="输入昵称" type="text" />
							<!--<span id="clearNickName" class="mui-icon-clear mui-icon"></span>-->
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--修改昵称end-->
		<!--修改地址-->
		<div id="editAddress" class="mui-page">
			<div class="header-control-color header-control header-control-fixed mui-navbar-inner">
				<div class="header-control-left-btn  mui-action-back">
					<span class="white-arrow-big-span header-control-left-btn-span"></span>
				</div>
				<div>
					<span id="webview-head-title">地址管理</span>
				</div>
				<div class="header-control-right-btn">
					<span class="header-control-right-btn-span">
						<button id="saveAddress" class="my-setting-save">保存</button>
					</span>
				</div>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<a class="my-setting-item my-setting-item-margin-top">
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">收件人</label>
							</div>
							<div class="my-setting-middle my-setting-border my-setting-middle-left">
								<input type="text" class="my-setting-middle-input" id="addressName" placeholder="请输入姓名" value="" />
							</div>
							<div class="my-setting-right my-setting-border">
							</div>
						</a>
						<a class="my-setting-item">
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">联系电话</label>
							</div>
							<div class="my-setting-middle my-setting-border my-setting-middle-left">
								<input type="text" class="my-setting-middle-input" id="addressPhone" placeholder="请输入联系电话" value="" />
							</div>
							<div class="my-setting-right my-setting-border">
							</div>
						</a>
						<a class="my-setting-item">
							<div class="my-setting-left my-setting-border">
								<label class="my-setting-left-text">所在城市</label>
							</div>
							<div class="my-setting-middle my-setting-border my-setting-middle-left" id="choiceAddress">
								<label class="my-setting-middle-text" id="addressCity">请选择所在城市</label>
							</div>
							<div class="my-setting-right my-setting-border">
								<span class="black-arrow-span"></span>
							</div>
						</a>
						<a class="my-setting-item">
							<div class="my-setting-left">
								<label class="my-setting-left-text">收货地址</label>
							</div>
							<div class="my-setting-middle my-setting-middle-left">
								<input type="text" class="my-setting-middle-input" id="addressDetail" placeholder="请输入详细地址" value="" />
							</div>
							<div class="my-setting-right">
							</div>
						</a>
					</div>
				</div>
			</div>
		</div>
		<!--修改地址end-->
		<!--修改手机号码-->
		<div id="editPhone" class="mui-page">
			<div class="header-control-color header-control header-control-fixed mui-navbar-inner">
				<div class="header-control-left-btn  mui-action-back">
					<span class="white-arrow-big-span header-control-left-btn-span"></span>
				</div>
				<div>
					<span id="webview-head-title">修改手机号码</span>
				</div>
				<div class="header-control-right-btn">
					<span class="header-control-right-btn-span">
					</span>
				</div>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll" style="transform: translate3d(0px, 0px, 0px) translateZ(0px); transition-duration: 0ms;">
						<a class="my-setting-item my-setting-item-margin-top">
							<div class="my-setting-left my-setting-border my-setting-left-input">
								<input id="phoneInput" class="editPhoneInput" placeholder="请输入新的手机号码" type="text">
							</div>
							<div class="my-setting-right my-setting-border">
							</div>
						</a>

						<a class="my-setting-item">
							<div class="my-setting-left my-setting-left-input  my-setting-border">
								<input id="authCodeInput" class="editPhoneInput" placeholder="请输入认证码" type="text">
							</div>
							<div class="my-setting-middle my-setting-middle-right  my-setting-border">
								<button id="getAuthCode">获取认证码</button>
							</div>
						</a>
						<a class="my-setting-item">
							<div class="my-setting-left my-setting-left-input">
								<input id="passwordInput" class="editPhoneInput" placeholder="请输入登录密码" type="password">
							</div>
							<div class="my-setting-right">
							</div>
						</a>

						<div class="postEditPhoneContainer">
							<button id="postEditPhone">
								保存并更新手机号
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--修改地址end-->
		<div id="about" class="mui-page">
			<div class="header-control-color header-control header-control-fixed mui-navbar-inner">
				<div class="header-control-left-btn mui-action-back">
					<span class="white-arrow-big-span header-control-left-btn-span"></span>
				</div>
				<div>
					<span id="webview-head-title">关于我们</span>
				</div>
				<div class="header-control-right-btn">
					<span class="help-about-span header-control-right-btn-span"></span>
				</div>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">

					</div>
				</div>
			</div>
		</div>

		<div id="feedback" class="mui-page feedback">
			<div class="header-control-color header-control header-control-fixed mui-navbar-inner">
				<div class="header-control-left-btn mui-action-back">
					<span class="white-arrow-big-span header-control-left-btn-span"></span>
				</div>
				<div>
					<span id="webview-head-title">问题反馈</span>
				</div>
				<div class="header-control-right-btn">
					<span class="help-about-span header-control-right-btn-span"></span>
				</div>
			</div>
			<div class="mui-page-content">
				<p class="feedback-margin my-setting-font-size">问题和意见</p>
				<div class="row mui-input-row">
					<textarea id='question' class="mui-input-clear question my-setting-font-size" placeholder="请详细描述你的问题和意见..."></textarea>
				</div>
				<p class="feedback-margin my-setting-font-size">图片(选填,提供问题截图)</p>
				<div id='image-list' class="row image-list">
				</div>
				<p class="feedback-margin my-setting-font-size ">QQ/邮箱</p>
				<div class="mui-input-row">
					<input id='contact' type="text" class="contact my-setting-font-size" placeholder="选填,方便我们联系你" />
				</div>
				<button id='submit' type="button" class="mui-btn mui-btn-green my-setting-font-size">提交</button>
			</div>
			<p>此示例基于环信 “WebIM SDK” + 环信 “移动客服” 实现，在环信 “移动客服面板” 能够查阅反馈信息。</p>
		</div>

		<!--选择性别-->
		<div id="sexList-item" class="mutual-div">
			<div id="postSexChoose">性别</div>
			<div class="sexList-item-group" id="setSexMan" data-tap="false">
				<div class="sexList-item-content">
					<span class="sex-man-span"></span>
				</div>
				<span class="sexList-item-content">男</span>
				<div class="sexList-item-content">
					<span class="radio-check-span"></span>
				</div>
			</div>
			<div class="sexList-item-group" id="setSexFemale" data-tap="false">
				<div class="sexList-item-content">
					<span class="sex-female-span"></span>
				</div>
				<span class="sexList-item-content">女</span>
				<div class="sexList-item-content">
					<span class="radio-check-span"></span>
				</div>
			</div>
		</div>
		<!--性别end-->

		<div class="my-toast" id="myToast">
			<span class="my-toast-content"></span>
		</div>
		<script src="../js/mui.min.js "></script>
		<script src="../js/exif.js"></script>
		<script src="../js/mui.view.js "></script>
		<script src='../js/feedback.js'></script>
		<script src="../js/feedback-page.js"></script>
		<script src="../js/md5.min.js"></script>
		<script src="../js/public.js"></script>
		<script src="../crop/action.js"></script>
		<script>
			mui.init();
			// 更新面板头像
			window.addEventListener("changeAvatar", function(e) {
				defaultImg("settingUserIMG", "../../www/img/head.jpg");
				document.querySelector("#__mui-imageview__group .mui-slider-item img").src = e.detail.url + "?version=" + new Date().getTime();
			});
			window.addEventListener("changeAddress", function(e) {
				document.getElementById("addressCity").innerText = plus.storage.getItem("cityName");
			});
			// 页面启动时
			mui.plusReady(function() {
				// 初始化面板
				document.getElementById("nickNameText").innerText = plus.storage.getItem("userName");
				document.getElementById("phoneText").innerText = plus.storage.getItem("userPhone");
				var val = plus.storage.getItem("userGender");
				if (val) {
					if (val == "1") {
						document.getElementById("genderText").innerText = "男";
						document.querySelector("#setSexMan .radio-check-span").classList.add("radio-check-active");
					} else {
						document.getElementById("genderText").innerText = "女";
						document.querySelector("#setSexFemale .radio-check-span").classList.add("radio-check-active");
					}
				}
				// 初始化验证码获取
				timew.start();
				getAddress();
			});
			//初始化单页view
			var viewApi = mui('#app').view({
				defaultPage: '#setting'
			});
			var view = viewApi.view;
			(function($) {
				//重写back事件，处理view的后退与webview后退
				var oldBack = $.back;
				$.back = function() {
					//如果头像预览是打开状态，那么返回键关闭预览
					var pictureView = document.querySelector("#__mui-imageview__");
					if (pictureView && pictureView.style.display == "block") {
						pictureView.style.display = "none";
						return;
					}
					//如果性别处于打开状态，返回键关闭性别选择窗口
					var id = "#sexList-item";
					var sexView = document.querySelector(id);
					if (sexView.classList.contains("mutual-div-active")) {
						fnCloseShade(id);
						return;
					}
					if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
						viewApi.back();
					} else { //执行webview后退
						oldBack();
					}
				};
				//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
				//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
				view.addEventListener('pageBeforeShow', function(e) {
					//				console.log(e.detail.page.id + ' beforeShow');
				});
				view.addEventListener('pageShow', function(e) {
					//				console.log(e.detail.page.id + ' show');
				});
				view.addEventListener('pageBeforeBack', function(e) {
					//				console.log(e.detail.page.id + ' beforeBack');
				});
				view.addEventListener('pageBack', function(e) {
					//				console.log(e.detail.page.id + ' back');
				});
			})(mui);
			// 初始化单页的区域滚动
			mui('.mui-scroll-wrapper').scroll();
			/*
			 * 修改手机号码start
			 */
			function checkInputStrict() {
				// 要求是号段正确，11位的手机号码
				// 6位数字验证码
				// 6~16位密码
				var val = document.getElementById("authCodeInput").value;
				var val2 = val.match(/^[0-9]*$/).toString();
				var val3 = document.getElementById("passwordInput").value;
				var result = true;
				switch (true) {
					case !checkPhoneInput():
						result = false;
						break;
					case val.length != 6:
						result = false;
						plus.nativeUI.alert("请输入6位数字长度的验证码");
						break;
					case val2.length != 6:
						result = false;
						mui.toast("验证码错误，请重新输入");
						break;
					case val3.length < 6 || 16 < val3.length:
						result = false;
						plus.nativeUI.alert("请输入6至16位长的密码");
						break;
					default:
						result = true;
						break;
				}
				return result;
			};
			// 验证手机号码是否为规范，规范才能发验证码、点击下一步
			function checkPhoneInput() {
				var val = document.getElementById("phoneInput").value;
				if (!/^(13|14|15|17|18)\d{9}$/.test(val)) {
					plus.nativeUI.alert("请输入正确的手机号", function() {}, "提示", "返回");
					return false;
				} else {
					return true;
				}
			};
			var btnAble = true;
			var btnAble2 = false;
			document.querySelector("#getAuthCode").addEventListener("tap", function() {
				if (!checkPhoneInput()) {
					return;
				}
				if (NetWorkStatus()) {
					return;
				}
				var nowTime = new Date().getTime().toString();
				var startTime = plus.storage.getItem("authCodeTime");
				if (startTime == null || (nowTime - startTime) / 1000 > 120) {
					// 申请验证码
					var URL = "http://farm.rrzuji.com/v1/code/create?" + fnCreateSign();
					if (!btnAble2) {
						btnAble2 = true;
						var nwaiting = plus.nativeUI.showWaiting("正在发送");
						mui.ajax(URL, {
							type: "POST",
							dataType: "JSON",
							data: {
								phone: document.getElementById("phoneInput").value
							},
							success: function(res) {
								res = JSON.parse(res);
								nwaiting.close();
								btnAble2 = false;
								if (res.success) {
									plus.storage.setItem("authCodeTime", new Date().getTime().toString());
									plus.storage.setItem("authCodeToken", res.data.code_token);
									plus.storage.setItem("resPhone", document.getElementById("phoneInput").value);
									timew.start();
									mui.toast("验证码已发送至您的手机上");
									console.log("验证码已发送");
								} else {
									mui.toast(res.data.message || res.data.error || "服务器错误");
								}
							},
							error: function(xhr, type, errorThrown) {
								nwaiting.close();
								btnAble2 = false;
								ajaxError();
							}
						});
					}
				}
			});
			//检查验证码
			function verifyAuthCode() {
				var p = new Promise(function(resolve, reject) {
					var token = plus.storage.getItem("authCodeToken");
					var URL = "http://farm.rrzuji.com/v1/code/check?" + fnCreateSign() + "&code-token=" + token;
					mui.ajax(URL, {
						type: "POST",
						dataType: "JSON",
						data: {
							"code": document.getElementById("authCodeInput").value,
						},
						success: function(res) {
							res = JSON.parse(res);
							if (res.success) {
								plus.storage.setItem("securityToken", res.data.security_token);
								resolve(res.data.security_token);
								console.log("验证码正确");
							} else {
								mui.toast(res.data.message || res.data.error || "服务器错误");
							}
							btnAble = true;
						},
						error: function(xhr, type, errorThrown) {
							btnAble = true;
							ajaxError();
						}
					});
				});
				return p;
			};
			document.getElementById("postEditPhone").addEventListener("tap", function() {
				if (!checkInputStrict()) {
					return;
				}
				if (!btnAble) {
					return;
				}
				if (NetWorkStatus()) {
					return;
				}
				btnAble = false;
				// 提交修改手机号码
				verifyAuthCode().then(
					function(securityCode) {
						var nwaiting = plus.nativeUI.showWaiting("正在重置手机号码");
						var URL = "http://farm.rrzuji.com/v1/security/new-password?" + fnCreateSign() + "&security-token=" + securityCode;
						mui.ajax(URL, {
							type: "POST",
							dataType: "JSON",
							data: {
								"phone": document.getElementById("phoneInput").value,
								"password": document.getElementById("passwordInput").value
							},
							success: function(res) {
								res = JSON.parse(res);
								nwaiting.close();
								btnAble = true;
								if (res.success) {
									mui.toast("重置手机号码成功");
									mui.back();
								} else {
									mui.toast("重置手机号码失败" + res.data.message || res.data.error || "服务器错误");
								}
							},
							error: function(xhr, type, errorThrown) {
								nwaiting.close();
								btnAble2 = true;
								ajaxError();
							}
						});
					}
				);
			});
			/*
			 * 修改手机号码end
			 */
			/**
			 *  退出登录start
			 */
			document.querySelector("#my-setting-loginout").addEventListener("tap", function() {
				if (mui.os.plus) {
					plus.nativeUI.confirm("确定退出登录？", function(e) {
						if (e.index == 0) {
							plus.storage.clear();
							deleteIMG();
							mui.fire(plus.webview.getWebviewById("webview-my.html"), "changeInfo", {});
							mui.toast("已退出登录状态");
							plus.webview.getWebviewById("secondlv/webview-my-setting.html").close();
						}
					}, "退出", ["确定", "取消"])
				}
			});
			/**
			 * 退出登录end 
			 */
			/**
			 * 修改性别start
			 * @param {Object} genderNum
			 */
			function setGender(genderNum) {
				if (NetWorkStatus()) {
					return;
				}
				if (genderNum == "1" || genderNum == "2") {
					var userID = plus.storage.getItem("userID");
					var token = plus.storage.getItem("tokenValue");
					var URL = "http://farm.rrzuji.com/v1/users/" + userID + "?" + fnCreateSign() + "&access-token=" + token;
					mui.ajax(URL, {
						type: "PUT",
						dataType: "JSON",
						data: {
							"gender": genderNum
						},
						success: function(res) {
							res = JSON.parse(res);
							if (res.success) {
								if (res.data.gender) {
									plus.storage.setItem("userGender", res.data.gender.toString());
								}
							}
						},
						error: function(xhr, error, thrownError) {
							try {
								console.log(JSON.stringify(xhr));
								var res = JSON.parse(xhr.response);
								if (typeof res.data.message !== "undefined") {
									mui.toast("更新性别信息失败" + res.data.message);
								}
							} catch (e) {
								console.log("调试信息，更新信息失败，服务器错误");
							}
						}
					});
				}
			}
			// 打开动画
			document.querySelector("#setSex").addEventListener("tap", function() {
				var _id = "#sexList-item";
				fnOpenTargetDiv(_id);
			});
			// 性别选项，男，点击
			document.querySelector("#setSexMan").addEventListener("tap", function() {
				var thisBtn = this;
				//防止重复点击
				if (thisBtn.getAttribute("data-tap") == "true") {
					return;
				}
				// 提交到服务器
				setGender("1");
				thisBtn.setAttribute("data-tap", "true");
				var _id = "#sexList-item";
				var _text = document.querySelector("#setSex .my-setting-middle-text");
				//处理点击逻辑
				var radioList = document.querySelectorAll(".radio-check-span");
				if (!radioList[0].classList.contains("radio-check-active") && radioList[1].classList.contains("radio-check-active")) {
					radioList[0].classList.add("radio-check-active");
					radioList[1].classList.remove("radio-check-active");
					_text.innerText = "男";
				} else if (!radioList[0].classList.contains("radio-check-active") && !radioList[1].classList.contains("radio-check-active")) {
					radioList[0].classList.add("radio-check-active");
					_text.innerText = "男";
				}
				//防止重复点击
				fnCloseShade(_id);
				setTimeout(function() {
					thisBtn.setAttribute("data-tap", "false");
				}, 200);
			});
			// 性别选项， 女， 点击
			document.querySelector("#setSexFemale").addEventListener("tap", function() {
				var thisBtn = this;
				if (thisBtn.getAttribute("data-tap") == "true") {
					return;
				}
				// 提交到服务器
				setGender("2");
				thisBtn.setAttribute("data-tap", "true");
				var _id = "#sexList-item";
				var _text = document.querySelector("#setSex .my-setting-middle-text");
				var radioList = document.querySelectorAll(".radio-check-span");
				if (!radioList[1].classList.contains("radio-check-active") && radioList[0].classList.contains("radio-check-active")) {
					radioList[1].classList.add("radio-check-active");
					radioList[0].classList.remove("radio-check-active");
					_text.innerText = "女";
				} else if (!radioList[1].classList.contains("radio-check-active") && !radioList[0].classList.contains("radio-check-active")) {
					radioList[1].classList.add("radio-check-active");
					_text.innerText = "女";
				}
				fnCloseShade(_id);
				setTimeout(function() {
					thisBtn.setAttribute("data-tap", "false");
				}, 200);
			});
			/**
			 * 修改性别end 
			 */
			/**
			 * 修改昵称start 
			 */
			document.getElementById("saveNickName").addEventListener("tap", function() {
				var val = document.getElementById("inputNickName").value;
				if (val.length > 50) {
					mui.toast("昵称过长，请重新输入");
					return;
				}
				if (NetWorkStatus()) {
					return;
				}
				var btn = this;
				btn.disable = true;
				var userID = plus.storage.getItem("userID");
				var token = plus.storage.getItem("tokenValue");
				var URL = "http://farm.rrzuji.com/v1/users/" + userID + "?" + fnCreateSign() + "&access-token=" + token;
				mui.ajax(URL, {
					type: "PUT",
					dataType: "JSON",
					data: {
						"name": val
					},
					success: function(res) {
						res = JSON.parse(res);
						if (res.success) {
							plus.storage.setItem("userName", res.data.name);
							mui.fire(plus.webview.getWebviewById("webview-my.html"), "changeNameOrPhone", {});
							document.getElementById("nickNameText").innerText = res.data.name;
							var w = plus.webview.getWebviewById("webview-comu-new.html");
							mui.fire(w, "refreshTab", {});
							mui.back();
						}
						setTimeout(function() {
							btn.disable = false;
						}, 150);
					},
					error: function(xhr, error, thrownError) {
						btn.disable = false;
						ajaxError(xhr);
					}
				});
			});
			/**
			 * 修改昵称end 
			 */
			/**
			 * 修改地址start 
			 */
			// 选择城市
			document.getElementById("choiceAddress").addEventListener("tap", function(e) {
				fnLoadPage(this, {
					url: "../thirdlv/choiceAddress.html",
					top: 98,
					bottom: 0
				}, {
					title: "选择所在城市",
					rightBtn: '<span id="saveCity" class="header-control-right-btn-span">确定</span>'
				});
				mui.fire(plus.webview.getWebviewById("webview-header"), "setCity", {});
			});
			// 选择城市end
			// 查看地址
			function getAddress() {
				if (NetWorkStatus()) {
					return;
				}
				var token = plus.storage.getItem("tokenValue");
				var URL = "http://farm.rrzuji.com/v1/address-add/view?" + fnCreateSign() + "&access-token=" + token;
				mui.ajax(URL, {
					type: "GET",
					dataType: "JSON",
					success: function(res) {
						console.log(res);
						res = JSON.parse(res);
						if (res.success) {
							// 无地址
							if (!res.data) {
								console.log("无收件地址");
							} else {
								// 更新面板
								document.getElementById("addressName").value = res.data.name;
								document.getElementById("addressPhone").value = res.data.phone;
								document.getElementById("addressCity").innerText = res.data.city_name;
								document.getElementById("addressDetail").value = res.data.address;
							}
						}
					},
					error: function(xhr, error, thrownError) {
						btn.disable = false;
						ajaxError(xhr);
					}
				});
			}
			document.getElementById("saveAddress").addEventListener("tap", function() {
				var elemName = document.getElementById("addressName");
				var elemPhone = document.getElementById("addressPhone");
				var elemCity = document.getElementById("addressCity");
				var elemDetail = document.getElementById("addressDetail");
				if (elemName.value.length == 0 || elemName.value.length > 50) {
					plus.nativeUI.alert("请输入收件人姓名!");
					return;
				}
				if (elemPhone.value.length == 0 || elemPhone.value.length > 50) {
					plus.nativeUI.alert("请输入收件人联系方式!");
					return;
				}
				if (elemCity.innerText == "请选择所在城市") {
					plus.nativeUI.alert("选择所在城市");
					return;
				}
				if (elemDetail.value.length == 0 || elemDetail.value.length > 50) {
					plus.nativeUI.alert("请输入详细地址!");
					return;
				}
				if (NetWorkStatus()) {
					return;
				}
				var btn = this;
				btn.disable = true;
				var userID = plus.storage.getItem("userID");
				var token = plus.storage.getItem("tokenValue");
				var URL = "http://farm.rrzuji.com/v1/address-add/update?" + fnCreateSign() + "&access-token=" + token;
				mui.ajax(URL, {
					type: "POST",
					dataType: "JSON",
					data: {
						"user_id": userID,
						"city_id": plus.storage.getItem("cityNum"),
						"city_name": plus.storage.getItem("cityName"),
						"name": elemName.value,
						"phone": elemPhone.value,
						"address": elemDetail.value
					},
					success: function(res) {
						res = JSON.parse(res);
						if (res.success) {
							mui.toast("成功保存地址");
							console.log(JSON.stringify(res));
							mui.back();
						}
						setTimeout(function() {
							btn.disable = false;
						}, 150);
					},
					error: function(xhr, error, thrownError) {
						btn.disable = false;
						ajaxError(xhr);
					}
				});
			});
			/**
			 * 修改地址end 
			 */
			// 检查更新
			document.getElementById("update").addEventListener('tap', function() {
				mui.toast('已是最新版本~');
				return true;
				var server = "http://www.dcloud.io/check/update"; //获取升级描述文件服务器地址
				mui.getJSON(server, {
					"appid": plus.runtime.appid,
					"version": plus.runtime.version,
					"imei": plus.device.imei
				}, function(data) {
					if (data.status) {
						plus.ui.confirm(data.note, function(i) {
							if (0 == i) {
								plus.runtime.openURL(data.url);
							}
						}, data.title, ["立即更新", "取　　消"]);
					} else {
						mui.toast('已是最新版本~')
					}
				});
			});
			//下面代码均为头像处理代码
			setTimeout(function() {
				defaultImg("settingUserIMG", "../../www/img/head.jpg");
				setTimeout(function() {
					initImgPreview();
				}, 300);
			}, 500);
			//修改头像
			document.getElementById("head").addEventListener("tap", function() {
				// 操作列表
				imgActions();
			});
			document.getElementById("settingUserIMG").addEventListener("tap", function(e) {
				e.stopPropagation();
			});
			// 图片预览
			function initImgPreview() {
				var imgs = document.querySelectorAll("#settingUserIMG");
				imgs = mui.slice.call(imgs);
				if (imgs && imgs.length > 0) {
					var slider = document.createElement("div");
					slider.setAttribute("id", "__mui-imageview__");
					slider.classList.add("mui-slider");
					slider.classList.add("mui-fullscreen");
					slider.style.display = "none";
					slider.addEventListener("tap", function() {
						slider.style.display = "none";
					});
					slider.addEventListener("touchmove", function(event) {
						event.preventDefault();
					})
					var slider_group = document.createElement("div");
					slider_group.setAttribute("id", "__mui-imageview__group");
					slider_group.classList.add("mui-slider-group");
					imgs.forEach(function(value, index, array) {
						//给图片添加点击事件，触发预览显示；
						value.addEventListener('tap', function() {
							slider.style.display = "block";
							_slider.refresh();
							_slider.gotoItem(index, 0);
						})
						var item = document.createElement("div");
						item.classList.add("mui-slider-item");
						var a = document.createElement("a");
						var img = document.createElement("img");
						img.setAttribute("src", value.src);
						a.appendChild(img)
						item.appendChild(a);
						slider_group.appendChild(item);
					});
					slider.appendChild(slider_group);
					document.body.appendChild(slider);
					var _slider = mui(slider).slider();
				}
			}
		</script>
	</body>

</html>