<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta content="telephone=no,email=no" name="format-detection">
		<script src="js/flexible_css.debug.js"></script>
		<script src="js/flexible.debug.js"></script>
		<script src="http://api.map.baidu.com/api?v=2.0&ak=iwvdqPIdPiGxdcqB2Tl28lLD"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/style.css" rel="stylesheet" />
		<title></title>
		<style>
			html,
			body {
				width: 100%;
				height: 100%;
			}
		</style>
	</head>

	<body>
		<div class="header-control header-control-greenBold head-tab-hide header-control-fixed">
			<div class="header-control-left-btn">
				<span class="header-control-left-btn-span"></span>
				<!--<span class="white-arrow-big-span header-control-left-btn-span"></span>-->
			</div>
			<div>
				<span id="webview-head-title">地图</span>
			</div>
			<div class="header-control-right-btn">
				<span class="header-control-right-btn-span white-three-point-span"></span>
			</div>
		</div>
		<div id="map" style="width:100%;height: 100%; "></div>
		<div class="my-toast" id="myToast">
			<span class="my-toast-content"></span>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/md5.min.js"></script>
		<script src="js/public.js"></script>
		<script>
			mui.init();
			var first = null;
			mui.back = function() {
				if (mui.os.plus) {
					mui.fire(plus.webview.getWebviewById("HBuilder"), "backHome", {});
				}
			};
			//			var tileLayer = new BMap.TileLayer();
			//			tileLayer.getTilesUrl = function(tileCoord, zoom) {
			//				var x = tileCoord.x;
			//				var y = tileCoord.y;
			//				return 'tiles/' + zoom + '/tile' + x + '_' + y + '.png';
			//			}
			//			var map = new BMap.Map('map', {
			//				minZoom: 12,
			//				maxZoom: 17
			//			});
			//			map.addTileLayer(tileLayer);
			//			map.addControl(new BMap.NavigationControl());
			//			map.centerAndZoom(new BMap.Point(117.936414, 24.580618), 17);
			// 分割线
			//			var geolocation = new BMap.Geolocation();
			//			geolocation.getCurrentPosition(function(r) {
			//				if (this.getStatus() == BMAP_STATUS_SUCCESS) {
			//					var mk = new BMap.Marker(r.point);
			//					map.addOverlay(mk);
			//					map.panTo(r.point);
			//					alert('您的位置：' + r.point.lng + ',' + r.point.lat);
			//				} else {
			//					alert('failed' + this.getStatus());
			//				}
			//			}, {
			//				enableHighAccuracy: true
			//			});
			//关于状态码
			//BMAP_STATUS_SUCCESS	检索成功。对应数值“0”。
			//BMAP_STATUS_CITY_LIST	城市列表。对应数值“1”。
			//BMAP_STATUS_UNKNOWN_LOCATION	位置结果未知。对应数值“2”。
			//BMAP_STATUS_UNKNOWN_ROUTE	导航结果未知。对应数值“3”。
			//BMAP_STATUS_INVALID_KEY	非法密钥。对应数值“4”。
			//BMAP_STATUS_INVALID_REQUEST	非法请求。对应数值“5”。
			//BMAP_STATUS_PERMISSION_DENIED	没有权限。对应数值“6”。(自 1.1 新增)
			//BMAP_STATUS_SERVICE_UNAVAILABLE	服务不可用。对应数值“7”。(自 1.1 新增)
			//BMAP_STATUS_TIMEOUT	超时。对应数值“8”。(自 1.1 新增)
			mui.plusReady(function() {
				document.querySelector(".white-three-point-span").addEventListener("tap", function() {
					console.log("获取");
					plus.geolocation.getCurrentPosition(function(p) {
						alert("Geolocation\nLatitude:" + p.coords.latitude + "\nLongitude:" + p.coords.longitude + "\nAltitude:" + p.coords.altitude);
						console.log(transform(p.coords.longitude, p.coords.latitude));
					}, function(e) {
						alert("Geolocation error: " + e.message);
					});
					//					var map = new plus.maps.Map("map");
					//					map.getUserLocation(function(state, point) {
					//						if (0 == state) {
					//							alert(JSON.stringify(point));
					//						} else {
					//							alert("Failed!");
					//						}
					//					});
				});
			});

			function transform(lon, lat) {
				// 百度地图API功能
				//谷歌坐标
				var x = lon;
				var y = lat;
				var ggPoint = new BMap.Point(x, y);
				//地图初始化
				var bm = new BMap.Map("map");
				bm.centerAndZoom(ggPoint, 15);
				bm.addControl(new BMap.NavigationControl());
				//添加谷歌marker和label
				var markergg = new BMap.Marker(ggPoint);
				bm.addOverlay(markergg); //添加谷歌marker
				var labelgg = new BMap.Label("未转换的谷歌标注（错误）", {
					offset: new BMap.Size(20, -10)
				});
				markergg.setLabel(labelgg); //添加谷歌label
				//坐标转换完之后的回调函数
				translateCallback = function(data) {
					if (data.status === 0) {
						var marker = new BMap.Marker(data.points[0]);
						bm.addOverlay(marker);
						var label = new BMap.Label("转换后的百度标注（正确）", {
							offset: new BMap.Size(20, -10)
						});
						marker.setLabel(label); //添加百度label
						bm.setCenter(data.points[0]);
					}
				}
				setTimeout(function() {
					var convertor = new BMap.Convertor();
					var pointArr = [];
					pointArr.push(ggPoint);
					convertor.translate(pointArr, 3, 5, translateCallback)
				}, 1000);
			}
		</script>
	</body>

</html>